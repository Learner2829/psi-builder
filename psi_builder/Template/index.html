<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Trading Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css"/>
  <style>
    body.dark-mode { background-color: #001020; color: white; }
    .positive { color: green; }
    .negative { color: red; }
    .remove-btn { background: red; color: white; border: none; padding: 4px 10px; border-radius: 4px; }
    .remove-btn:hover { background: darkred; }
    .autocomplete-items {
      border: 1px solid #ddd;
      max-height: 150px;
      overflow-y: auto;
      z-index: 99;
      position: absolute;
      background: white;
      width: 100%;
    }
    .autocomplete-items div {
      padding: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }
    .autocomplete-items div:hover {
      background-color: #e9e9e9;
    }
  </style>
</head>
<body class="dark-mode">
  <div class="container py-4">
    <h1 class="text-center mb-4">Trading Dashboard</h1>

    <div class="d-flex justify-content-between mb-4">
      <div class="position-relative w-75">
        <input id="stockSearch" type="text" class="form-control" placeholder="Search stock (Tata, Adani, Birla)" autocomplete="off">
        <div id="autocomplete-list" class="autocomplete-items"></div>
      </div>
      <button id="themeToggle" class="btn btn-secondary">Toggle Theme</button>
    </div>

    <table id="stockTable" class="table table-striped table-bordered" style="width:100%; display:none;">
      <thead class="table-dark">
        <tr>
          <th>Symbol</th><th>Token</th><th>Price</th><th>High</th><th>Low</th><th>LTP</th>
          <th>Change (%)</th><th>Action</th><th>Indicator</th><th>Remove</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
  <script>
    const stocks = ["Tata", "Adani", "Birla"];
    const tokenMap = {
      "TATA": "0001",
      "ADANI": "0002",
      "BIRLA": "0003"
    };
    let dataTable;

    const searchInput = document.getElementById("stockSearch");
    const autoList = document.getElementById("autocomplete-list");

    searchInput.addEventListener("input", () => {
      const val = searchInput.value.trim().toLowerCase();
      autoList.innerHTML = "";
      if (!val) return;

      stocks.forEach(stock => {
        if (stock.toLowerCase().startsWith(val)) {
          const item = document.createElement("div");
          item.innerHTML = `
            <span>${stock}</span>
            <button class="btn btn-sm btn-primary float-end add-stock-btn" data-stock="${stock}">Add</button>
          `;
          autoList.appendChild(item);
        }
      });

      document.querySelectorAll(".add-stock-btn").forEach(btn => {
        btn.addEventListener("click", (e) => {
          e.stopPropagation();
          const stock = e.target.getAttribute("data-stock");
          addStock(stock.toUpperCase());
          searchInput.value = "";
          autoList.innerHTML = "";
        });
      });
    });

    document.addEventListener("click", (e) => {
      if (e.target !== searchInput) autoList.innerHTML = "";
    });

    function addStock(symbol) {
      if (!dataTable) {
        $('#stockTable').show();
        dataTable = new DataTable('#stockTable');
      }

      const exists = dataTable
        .rows()
        .data()
        .toArray()
        .some(row => row[0] === symbol);

      if (exists) return alert("Stock already added.");

      const token = tokenMap[symbol] || "----";

      const row = [
        symbol,
        token,
        "$0", "$0", "$0", "$0",
        `<span class="negative">0%</span>`,
        "-", "-", `<button class="remove-btn">Remove</button>`
      ];
      dataTable.row.add(row).draw();
    }

    $('#stockTable tbody').on('click', '.remove-btn', function () {
      dataTable.row($(this).parents('tr')).remove().draw();
      if (dataTable.rows().count() === 0) $('#stockTable').hide();
    });

    document.getElementById("themeToggle").addEventListener("click", () => {
      document.body.classList.toggle("dark-mode");
      localStorage.setItem("theme", document.body.classList.contains("dark-mode") ? "dark" : "light");
    });

    window.onload = () => {
      if (localStorage.getItem("theme") === "light") {
        document.body.classList.remove("dark-mode");
      }
    };
  </script>
</body>
</html>
